<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MyMailerApp - Accounts</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
  <h1 class="text-primary mb-3">ðŸ“‚ MyMailerApp - Accounts</h1>

  <form id="multiForm">
    <table class="table table-hover bg-white shadow-sm">
      <thead class="table-dark">
        <tr><th>Select</th><th>Email</th><th>Label</th></tr>
      </thead>
      <tbody>
      {% for id, email, label in accounts %}
        <tr>
          <td><input type="checkbox" name="acc" value="{{ id }}"></td>
          <td>{{ email }}</td>
          <td>{{ label or '' }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <button type="button" id="checkBtn" class="btn btn-primary">Check Selected (max 5)</button>
  </form>

  <div id="results" class="mt-4"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById("checkBtn").onclick = async () => {
  let ids = [...document.querySelectorAll('input[name=acc]:checked')].map(cb => cb.value);
  if (ids.length === 0) return alert("Select at least one account");
  if (ids.length > 5) return alert("Max 5 accounts at once");

  document.getElementById("results").innerHTML =
    "<div class='spinner-border text-primary'></div> Checking...";

  let res = await fetch("/api/check_multi", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ids: ids})
  });
  let data = await res.json();

  let out = "";
  for (let acc in data) {
    out += `<div class="card mb-3 shadow-sm"><div class="card-body">`;
    out += `<h5 class="card-title text-primary">ðŸ“§ ${acc}</h5>`;
    let folders = data[acc];
    if (folders.error) {
      out += `<div class="alert alert-danger">${folders.error}</div>`;
    } else {
      out += `<h6>Inbox</h6>`;
      out += folders.INBOX.length ? `<ul class="list-group mb-2">` : `<p class="text-muted">No Inbox messages</p>`;
      folders.INBOX.forEach(s => out += `<li class="list-group-item">${s}</li>`);
      if (folders.INBOX.length) out += `</ul>`;

      out += `<h6 class="mt-3">Spam</h6>`;
      out += folders.SPAM.length ? `<ul class="list-group">` : `<p class="text-muted">No Spam messages</p>`;
      folders.SPAM.forEach(s => out += `<li class="list-group-item">${s}</li>`);
      if (folders.SPAM.length) out += `</ul>`;
    }
    out += "</div></div>";
  }
  document.getElementById("results").innerHTML = out;
};
</script>
</body>
</html>
