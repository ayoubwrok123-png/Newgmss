<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MyMailerApp - Accounts</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .container-narrow { max-width: 900px; margin: auto; }
    .results-card { margin-top: 20px; }
    .list-group-item { font-size: 0.95rem; }
  </style>
</head>
<body>

<div class="container-narrow py-4">
  <h1 class="text-primary mb-3 text-center">üìÇ MyMailerApp - Accounts</h1>

  <form id="multiForm" class="mb-3">
    <table class="table table-sm table-hover bg-white shadow-sm text-center align-middle">
      <thead class="table-dark">
        <tr><th>Select</th><th>Email</th><th>Label</th></tr>
      </thead>
      <tbody>
      {% for id, email, label in accounts %}
        <tr>
          <td><input type="checkbox" name="acc" value="{{ id }}"></td>
          <td class="text-start">{{ email }}</td>
          <td>{{ label or '' }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="d-flex justify-content-center">
      <button type="button" id="checkBtn" class="btn btn-primary btn-lg">
        üîç Check Selected (max 5)
      </button>
    </div>
  </form>

  <!-- Results directly under button -->
  <div id="results"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById("checkBtn").onclick = async () => {
  let ids = [...document.querySelectorAll('input[name=acc]:checked')].map(cb => cb.value);
  if (ids.length === 0) return alert("Select at least one account");
  if (ids.length > 5) return alert("Max 5 accounts at once");

  document.getElementById("results").innerHTML =
    "<div class='text-center mt-3'><div class='spinner-border text-primary'></div><p>Checking...</p></div>";

  let res = await fetch("/api/check_multi", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ids: ids})
  });
  let data = await res.json();

  let out = "";
  for (let acc in data) {
    out += `
    <div class="card shadow-sm results-card">
      <div class="card-header bg-primary text-white">
        üìß ${acc}
      </div>
      <div class="card-body">
    `;

    let folders = data[acc];
    if (folders.error) {
      out += `<div class="alert alert-danger">${folders.error}</div>`;
    } else {
      // Inbox
      out += `<h6 class="text-success">Inbox</h6>`;
      if (folders.INBOX.length) {
        out += `<ul class="list-group mb-3">`;
        folders.INBOX.forEach(s => out += `<li class="list-group-item">${s}</li>`);
        out += `</ul>`;
      } else {
        out += `<p class="text-muted">No Inbox messages</p>`;
      }

      // Spam
      out += `<h6 class="text-danger">Spam</h6>`;
      if (folders.SPAM.length) {
        out += `<ul class="list-group">`;
        folders.SPAM.forEach(s => out += `<li class="list-group-item">${s}</li>`);
        out += `</ul>`;
      } else {
        out += `<p class="text-muted">No Spam messages</p>`;
      }
    }

    out += "</div></div>";
  }

  document.getElementById("results").innerHTML = out;
};
</script>
</body>
</html>
